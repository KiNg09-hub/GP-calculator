DOCTYPE html>
<html>
<head>
  <title>SPM GP Calculator + PDF</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body { font-family: Arial; max-width: 650px; margin: 20px auto; }
    input, button, select { padding: 10px; margin: 5px 0; width: 100%; }
    .subject-box { padding: 10px; border: 1px solid #ccc; margin-bottom: 10px; }
    #downloadBtn { display:none; }
  </style>
</head>
<body>

  <h2>Kalkulator Gred Purata (GP) – SPM</h2>

  <label>Jumlah Subjek SPM Diambil:</label>
  <input type="number" id="totalSubjects" min="1" placeholder="Contoh: 9">
  <button onclick="generateSubjects()">Set</button>

  <div id="subjectsContainer"></div>

  <button onclick="calculateGP()" id="calcBtn" style="display:none;">Kira GP</button>
  <button id="downloadBtn" onclick="downloadPDF()">Muat Turun PDF</button>

  <h3>Keputusan:</h3>
  <div id="result">-</div>

  <script>
    const spmSubjects = [
      "Bahasa Melayu",
      "Bahasa Inggeris",
      "Matematik",
      "Sains",
      "Sejarah",
      "Matematik Tambahan",
      "Fizik",
      "Kimia",
      "Biologi",
      "Pendidikan Islam",
      "Pendidikan Moral",
      "Ekonomi",
      "Perakaunan",
      "Perniagaan",
      "Reka Bentuk & Teknologi (RBT)",
      "Sains Komputer",
      "Prinsip Perakaunan",
      "Geografi",
      "Kesusasteraan Melayu",
      "Kesusasteraan Tamil",
      "Seni Visual",
      "Pendidikan Jasmani & Kesihatan"
      "Bahasa Tamil"
      "Bahasa Cina"
      "Bahasa Arab"
      "Pendidikan Al-Quran dan Al-Sunnah"
      "Pendidikan Syariah Islamiah"
    ];

    function generateSubjects() {
      const num = Number(document.getElementById("totalSubjects").value);
      const container = document.getElementById("subjectsContainer");
      container.innerHTML = "";

      if (num <= 0) return;

      for (let i = 1; i <= num; i++) {
        container.innerHTML += `
          <div class="subject-box">
            <label>Subjek ${i}:</label>
            <select class="subName">
              ${spmSubjects.map(sub => `<option value="${sub}">${sub}</option>`).join("")}
            </select>

            <label>Markah Subjek ${i} (0-100):</label>
            <input type="number" class="subMark" min="0" max="100">
          </div>
        `;
      }

      document.getElementById("calcBtn").style.display = "block";
    }

    function getGradeData(mark) {
      if (mark >= 90) return { grade: "A+", value: 0 };
      if (mark >= 80) return { grade: "A", value: 1 };
      if (mark >= 70) return { grade: "A-", value: 2 };
      if (mark >= 66) return { grade: "B+", value: 3 };
      if (mark >= 60) return { grade: "B", value: 4 };
      if (mark >= 55) return { grade: "C+", value: 5 };
      if (mark >= 50) return { grade: "C", value: 6 };
      if (mark >= 46) return { grade: "D", value: 7 };
      if (mark >= 40) return { grade: "E", value: 8 };
      if (mark >= 0)  return { grade: "F", value: 9 };
      return { grade: "-", value: 0 };
    }

    let pdfData = ""; // stored text for PDF

    function calculateGP() {
      const marks = document.querySelectorAll(".subMark");
      const subjects = document.querySelectorAll(".subName");

      let totalValue = 0;
      let totalSubjects = marks.length;

      let output = "<b>Butiran Setiap Subjek:</b><br>";
      let pdfText = "BUTIRAN KEPUTUSAN SPM GP\n\n";

      marks.forEach((m, i) => {
        let mark = Number(m.value);
        const data = getGradeData(mark);

        totalValue += data.value;

        output += `${subjects[i].value}: Markah ${mark} → Gred ${data.grade}<br>`;
        pdfText += `${subjects[i].value}: ${mark} → ${data.grade}\n`;
      });

      let gp = (totalValue / totalSubjects).toFixed(2);

      output += `<br><b>GP Akhir: ${gp}</b><br>(Lebih rendah = lebih baik)`;
      pdfText += `\nGP Akhir: ${gp}\n`;

      document.getElementById("result").innerHTML = output;

      pdfData = pdfText;
      document.getElementById("downloadBtn").style.display = "block";
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      let lines = pdfData.split("\n");
      let y = 10;

      doc.setFontSize(12);

      lines.forEach(line => {
        doc.text(line, 10, y);
        y += 8;
      });

      doc.save("keputusan_gp.pdf");
    }
  </script>

</body>
</html>

