<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SPM GP Calculator + PDF</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    /* Smooth theme transition */
    * { transition: 0.2s ease-in-out; }
  </style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen p-6">

  <!-- Page Title -->
  <h2 class="text-3xl font-bold mb-4 text-center">Kalkulator Gred Purata (GP) – SPM</h2>

  <!-- SUBJECT COUNT INPUT -->
  <div id="setupArea" class="max-w-xl mx-auto bg-white dark:bg-gray-800 p-5 rounded-xl shadow">
    <label class="font-semibold">Jumlah Subjek SPM Diambil:</label>
    <input type="number" id="totalSubjects" min="1"
           class="w-full p-3 rounded-lg border dark:border-gray-700 mt-2 bg-gray-50 dark:bg-gray-700">
    <button onclick="generateSubjects()"
            class="w-full mt-3 bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700">
      Set
    </button>
  </div>

  <!-- Subjects Container -->
  <div id="subjectsContainer" class="max-w-xl mx-auto mt-6"></div>

  <!-- Buttons -->
  <div class="max-w-xl mx-auto mt-4">
    <button id="calcBtn"
            onclick="calculateGP()"
            class="hidden w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700">
      Kira GP
    </button>

    <button id="downloadBtn"
            onclick="downloadPDF()"
            class="hidden w-full mt-3 bg-orange-600 text-white py-3 rounded-lg hover:bg-orange-700">
      Muat Turun PDF
    </button>
  </div>

  <!-- Result Output -->
  <div class="max-w-xl mx-auto mt-6">
    <h3 class="text-xl font-bold">Keputusan:</h3>
    <div id="result" class="mt-2 p-4 rounded-lg bg-white dark:bg-gray-800 shadow">-</div>
  </div>

<script>
/* --------------------------------------------
   ORIGINAL SUBJECT LIST (YOUR VERSION)
---------------------------------------------*/
const spmSubjects = [
  "Bahasa Melayu","Bahasa Inggeris","Matematik","Sains","Sejarah",
  "Matematik Tambahan","Fizik","Kimia","Biologi","Pendidikan Islam",
  "Pendidikan Moral","Ekonomi","Perakaunan","Perniagaan",
  "Reka Bentuk & Teknologi (RBT)","Sains Komputer","Prinsip Perakaunan",
  "Geografi","Kesusasteraan Melayu","Kesusasteraan Tamil",
  "Seni Visual","Pendidikan Jasmani & Kesihatan",
  "Bahasa Tamil","Bahasa Cina","Bahasa Arab",
  "Pendidikan Al-Quran dan Al-Sunnah","Pendidikan Syariah Islamiah"
];

/* --------------------------------------------
   HIDE SETUP AREA + GENERATE SUBJECT INPUTS
---------------------------------------------*/
function generateSubjects() {
  const total = parseInt(document.getElementById("totalSubjects").value);
  const cont = document.getElementById("subjectsContainer");

  if (total <= 0) return;

  // Hide setup area after Set pressed
  document.getElementById("setupArea").style.display = "none";

  cont.innerHTML = "";

  // Build dropdown + mark input
  for (let i = 1; i <= total; i++) {
    cont.innerHTML += `
      <div class="bg-white dark:bg-gray-800 border dark:border-gray-700 p-4 mb-3 rounded-xl shadow">
        <label class="font-medium">Subjek ${i}</label>

        <select data-subject
          class="w-full mt-2 p-3 rounded-lg border dark:border-gray-700 bg-gray-50 dark:bg-gray-700">
          ${spmSubjects.map(s => `<option value="${s}">${s}</option>`).join("")}
        </select>

        <input type="number" data-mark placeholder="Markah (0-100)"
          class="w-full mt-3 p-3 rounded-lg border dark:border-gray-700 bg-gray-50 dark:bg-gray-700">
      </div>`;
  }

  document.getElementById("calcBtn").classList.remove("hidden");
}

/* --------------------------------------------
   GRADE SYSTEM → LETTER ONLY
---------------------------------------------*/
function getGradeLetter(mark) {
  if (mark >= 90) return "A+";
  if (mark >= 80) return "A";
  if (mark >= 70) return "A-";
  if (mark >= 66) return "B+";
  if (mark >= 60) return "B";
  if (mark >= 55) return "C+";
  if (mark >= 50) return "C";
  if (mark >= 46) return "D";
  if (mark >= 40) return "E";
  return "F";
}

/* --------------------------------------------
   CALCULATE GP + DUPLICATE SUBJECT CHECK
---------------------------------------------*/
function calculateGP() {
  const subjects = [...document.querySelectorAll("[data-subject]")].map(s => s.value);
  const marks = [...document.querySelectorAll("[data-mark]")].map(m => parseInt(m.value));

  // 1) Check duplicate subjects
  const duplicate = subjects.find((s, i) => subjects.indexOf(s) !== i);
  if (duplicate) {
    alert("Ralat: Subjek '" + duplicate + "' dipilih lebih dari sekali!");
    return;
  }

  // 2) Build output HTML
  let html = "";
  let totalMarks = 0;
  let maxMarks = subjects.length * 100;

  subjects.forEach((subj, i) => {
    const grade = getGradeLetter(marks[i]);
    totalMarks += marks[i];

    html += `
      <div class="mb-2">
        <b>${subj}</b> — Markah: ${marks[i]} — Gred: <span class="font-bold text-indigo-600">${grade}</span>
      </div>`;
  });

  html += `
    <hr class="my-3 border-gray-300 dark:border-gray-700">
    <div class="text-lg font-bold">
      Jumlah Markah: ${totalMarks} / ${maxMarks}
    </div>`;

  document.getElementById("result").innerHTML = html;
  document.getElementById("downloadBtn").classList.remove("hidden");
}

/* --------------------------------------------
   PDF DOWNLOAD (jsPDF)
---------------------------------------------*/
function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFontSize(14);
  doc.text("Keputusan GP SPM", 10, 10);

  let y = 20;

  const text = document.getElementById("result").innerText.split("\n");
  text.forEach(line => {
    doc.text(line, 10, y);
    y += 8;
  });

  doc.save("Keputusan_SPM.pdf");
}
</script>

</body>
</html>
