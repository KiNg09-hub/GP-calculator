<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SPM GP Calculator</title>

  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>
<body class="bg-slate-100">

  <div class="max-w-2xl mx-auto mt-10 bg-white p-8 rounded-2xl shadow-lg border border-slate-200">

    <h2 class="text-3xl font-bold text-indigo-600 mb-5 text-center">
      Kalkulator Gred Purata (GP) â€“ SPM
    </h2>

    <!-- SUBJECT COUNT INPUT -->
    <label class="font-medium text-slate-700">Jumlah Subjek SPM Diambil:</label>
    <input type="number" id="totalSubjects" min="1"
           class="w-full p-3 mt-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-400"
           placeholder="Contoh: 9">

    <button onclick="generateSubjects()"
            class="w-full mt-3 bg-indigo-500 hover:bg-indigo-600 text-white py-3 rounded-xl font-semibold">
      Set
    </button>

    <div id="subjectsContainer" class="mt-6"></div>

    <button id="calcBtn"
            onclick="calculateGP()"
            class="w-full mt-4 bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold hidden">
      Kira GP
    </button>

    <button id="downloadBtn"
            onclick="downloadPDF()"
            class="w-full mt-3 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-semibold hidden">
      Muat Turun PDF
    </button>

    <h3 class="text-xl font-bold mt-6 text-slate-700">Keputusan:</h3>
    <div id="result" class="text-lg mt-2 font-semibold text-indigo-700">-</div>

  </div>

  <script>
    const subjectList = [
      "Bahasa Melayu",
      "Bahasa Inggeris",
      "Matematik",
      "Sains",
      "Sejarah",
      "Matematik Tambahan",
      "Fizik",
      "Kimia",
      "Biologi",
      "Pendidikan Islam",
      "Pendidikan Moral",
      "Ekonomi",
      "Perakaunan",
      "Perniagaan",
      "Reka Bentuk & Teknologi (RBT)",
      "Sains Komputer",
      "Prinsip Perakaunan",
      "Geografi",
      "Kesusasteraan Melayu",
      "Kesusasteraan Tamil",
      "Seni Visual",
      "Pendidikan Jasmani & Kesihatan",
      "Bahasa Tamil",
      "Bahasa Cina",
      "Bahasa Arab",
      "Pendidikan Al-Quran dan Al-Sunnah",
      "Pendidikan Syariah Islamiah"
    ];

    function getGradeData(mark) {
      if (mark >= 90) return { grade: "A+", value: 0 };
      if (mark >= 80) return { grade: "A", value: 1 };
      if (mark >= 70) return { grade: "A-", value: 2 };
      if (mark >= 66) return { grade: "B+", value: 3 };
      if (mark >= 60) return { grade: "B", value: 4 };
      if (mark >= 55) return { grade: "C+", value: 5 };
      if (mark >= 50) return { grade: "C", value: 6 };
      if (mark >= 46) return { grade: "D", value: 7 };
      if (mark >= 40) return { grade: "E", value: 8 };
      if (mark >= 0) return { grade: "F", value: 9 };
      return { grade: "-", value: 0 };
    }

    function generateSubjects() {
      const total = parseInt(document.getElementById("totalSubjects").value);
      const container = document.getElementById("subjectsContainer");
      container.innerHTML = "";

      if (total <= 0) return;

      for (let i = 1; i <= total; i++) {
        container.innerHTML += `
          <div class="bg-white border border-slate-300 p-4 rounded-xl shadow-sm mt-3">

            <label class="font-medium text-slate-700">Subjek ${i}</label>

            <select class="w-full mt-2 p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-400" data-subject>
              ${subjectList.map(sub => `<option value="${sub}">${sub}</option>`).join("")}
            </select>

            <input type="number" data-mark
                   placeholder="Markah (0 - 100)"
                   class="w-full mt-3 p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-400">
          </div>
        `;
      }

      document.getElementById("calcBtn").classList.remove("hidden");
    }

    function calculateGP() {
      const marks = Array.from(document.querySelectorAll("[data-mark]")).map(m => parseInt(m.value));
      const subjects = Array.from(document.querySelectorAll("[data-subject]")).map(s => s.value);

      let totalValue = 0;
      let resultText = "";

      subjects.forEach((subj, i) => {
        let m = marks[i];
        if (isNaN(m)) m = 0;

        const data = getGradeData(m);
        totalValue += data.value;

        resultText += `${subj}: ${data.grade} (GP ${data.value})<br>`;
      });

      const gp = (totalValue / subjects.length).toFixed(2);

      document.getElementById("result").innerHTML =
        resultText + `<br><span class="text-green-600 font-bold">Gred Purata: ${gp}</span>`;

      document.getElementById("downloadBtn").classList.remove("hidden");
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();

      pdf.text("SPM GP Calculator Result", 10, 10);

      let y = 20;
      document.getElementById("result").innerHTML
        .replace(/<br>/g, "\n")
        .split("\n")
        .forEach(line => {
          pdf.text(line, 10, y);
          y += 8;
        });

      pdf.save("gp_result.pdf");
    }
  </script>

</body>
</html>
