<!DOCTYPE html>
<html lang="ms" class="dark:bg-gray-900 dark:text-white">
<head>
    <meta charset="UTF-8">
    <title>Kalkulator GP SPM</title>

    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        // Enable auto dark/light mode based on OS
        tailwind.config = {
            darkMode: "media"
        };
    </script>

    <style>
        body { font-family: Arial, sans-serif; }
    </style>
</head>
<body class="min-h-screen p-6">

    <div class="max-w-2xl mx-auto">

        <h1 class="text-3xl font-bold mb-4 text-center">
            Kalkulator Gred Purata (GP) – SPM
        </h1>

        <!-- INPUT: TOTAL SUBJECTS -->
        <div id="setupSection" class="mb-6">
            <label class="font-semibold">Jumlah Subjek SPM Diambil:</label>
            <input type="number" id="totalSubjects" min="1"
                   class="w-full p-3 rounded-lg border border-gray-300 dark:border-gray-700 mt-2"
                   placeholder="Contoh: 9">

            <button onclick="generateSubjects()"
                    class="w-full mt-3 bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded-lg font-semibold">
                Set
            </button>
        </div>

        <!-- DYNAMIC SUBJECT FORMS -->
        <div id="subjectsContainer" class="space-y-4"></div>

        <!-- CALCULATE BUTTON -->
        <button id="calcBtn" onclick="calculateGP()" class="hidden w-full mt-5 bg-green-600 hover:bg-green-700 text-white p-3 rounded-lg font-semibold">
            Kira GP
        </button>

        <!-- RESULT OUTPUT -->
        <h2 class="text-2xl font-bold mt-8">Keputusan:</h2>
        <div id="result" class="mt-3 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg border dark:border-gray-700 text-lg">
            -
        </div>

    </div>

<script>
/* -------------------------------------------------------
   SPM SUBJECT LIST (Original)
------------------------------------------------------- */
const spmSubjects = [
    "Bahasa Melayu", "Bahasa Inggeris", "Matematik", "Sains",
    "Sejarah", "Matematik Tambahan", "Fizik", "Kimia", "Biologi",
    "Pendidikan Islam", "Pendidikan Moral", "Ekonomi", "Perakaunan",
    "Perniagaan", "Reka Bentuk & Teknologi (RBT)", "Sains Komputer",
    "Prinsip Perakaunan", "Geografi", "Kesusasteraan Melayu",
    "Kesusasteraan Tamil", "Seni Visual", "Pendidikan Jasmani & Kesihatan",
    "Bahasa Tamil", "Bahasa Cina", "Bahasa Arab",
    "Pendidikan Al-Quran dan Al-Sunnah", "Pendidikan Syariah Islamiah"
];

/* -------------------------------------------------------
   GRADE CONVERSION BASED ON MARK (letters only)
------------------------------------------------------- */
function getGrade(mark) {
    mark = Number(mark);

    if (mark >= 90) return "A+";
    if (mark >= 80) return "A";
    if (mark >= 70) return "A-";
    if (mark >= 66) return "B+";
    if (mark >= 60) return "B";
    if (mark >= 55) return "C+";
    if (mark >= 50) return "C";
    if (mark >= 46) return "D";
    if (mark >= 40) return "E";
    return "F";
}

/* -------------------------------------------------------
   GENERATE SUBJECT INPUTS
------------------------------------------------------- */
function generateSubjects() {
    const total = parseInt(document.getElementById("totalSubjects").value);
    const container = document.getElementById("subjectsContainer");

    if (total < 1) return;

    container.innerHTML = ""; // clear previous

    // Hide setup section after pressing Set
    document.getElementById("setupSection").classList.add("hidden");

    // Generate cards
    for (let i = 1; i <= total; i++) {
        container.innerHTML += `
            <div class="p-4 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-xl shadow">
                
                <label class="font-semibold">Subjek ${i}</label>

                <select data-subject
                        class="w-full mt-2 p-3 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-900">
                    ${spmSubjects.map(s => `<option value="${s}">${s}</option>`).join("")}
                </select>

                <input data-mark type="number" min="0" max="100"
                       class="w-full mt-3 p-3 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-900"
                       placeholder="Markah (0 - 100)">
            </div>
        `;
    }

    // Show calculate button
    document.getElementById("calcBtn").classList.remove("hidden");
}

/* -------------------------------------------------------
   CALCULATE GP + CHECK DUPLICATE SUBJECTS
------------------------------------------------------- */
function calculateGP() {
    const selectedSubjects = [...document.querySelectorAll("[data-subject]")].map(s => s.value);

    // Detect duplicates
    const duplicates = selectedSubjects.filter((sub, index) => selectedSubjects.indexOf(sub) !== index);

    if (duplicates.length > 0) {
        document.getElementById("result").innerHTML =
            `<span class='text-red-600 font-bold'>
                Ralat: Subjek tidak boleh diulang (${duplicates[0]})
             </span>`;
        return;
    }

    // Collect marks
    const markInputs = [...document.querySelectorAll("[data-mark]")];
    let totalMarks = 0;
    let totalSubjects = markInputs.length;

    let outputHTML = "";

    markInputs.forEach((input, index) => {
        const mark = Number(input.value);
        const subject = selectedSubjects[index];
        const grade = getGrade(mark);

        if (isNaN(mark) || mark < 0 || mark > 100) {
            outputHTML += `<p class='text-red-500'>${subject}: Markah tidak sah!</p>`;
            return;
        }

        totalMarks += mark;

        outputHTML += `
            <p>
                <strong>${subject}</strong> — Markah: ${mark} — Gred: 
                <span class="font-bold text-indigo-600 dark:text-indigo-400">${grade}</span>
            </p>
        `;
    });

    const maxMarks = totalSubjects * 100;

    // Final summary
    outputHTML += `
        <hr class="my-4 border-gray-400 dark:border-gray-700">
        <p class="text-lg font-bold">
            Jumlah Markah: ${totalMarks} / ${maxMarks}
        </p>
    `;

    document.getElementById("result").innerHTML = outputHTML;
}

</script>

</body>
</html>
