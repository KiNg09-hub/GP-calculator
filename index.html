<!DOCTYPE html>
<html lang="ms">
<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>SPM GP Calculator</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Auto Theme: Light/Dark follow device -->
  <script>
    tailwind.config = {
      darkMode: "media"
    };
  </script>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>

<body class="bg-gray-100 dark:bg-gray-900 dark:text-white min-h-screen p-6">

  <!-- MAIN CARD -->
  <div class="max-w-3xl mx-auto bg-white dark:bg-gray-800 shadow-xl rounded-xl p-8">

    <!-- TITLE -->
    <h1 class="text-3xl font-bold text-indigo-600 dark:text-indigo-300 mb-3">
      SPM GP Calculator
    </h1>

    <p class="text-sm text-gray-600 dark:text-gray-300 mb-6">
      Masukkan subjek, pilih subjek, masukkan markah, dan sistem akan kira GP.
    </p>

    <!-- INPUT: NUMBER OF SUBJECTS -->
    <div id="setupArea">
      <label class="font-semibold">Jumlah Subjek:</label>
      <div class="flex gap-3 mt-2">
        <input id="totalSubjects" type="number" min="1"
          class="flex-1 p-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700">
        <button onclick="generateSubjects()"
          class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-semibold shadow">
          Set
        </button>
      </div>
    </div>

    <!-- SUBJECT BLOCKS -->
    <div id="subjectsContainer" class="mt-6 space-y-4"></div>

    <!-- BUTTONS AFTER SUBJECTS GENERATED -->
    <div class="flex gap-4 mt-6">
      <button id="calcBtn" onclick="calculateGP()" class="hidden flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-3 rounded-lg font-semibold shadow">
        Kira GP
      </button>

      <button id="downloadBtn" onclick="downloadPDF()" class="hidden flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold shadow">
        Muat Turun PDF
      </button>
    </div>

    <!-- OUTPUT -->
    <h2 class="text-xl font-semibold mt-10">Keputusan:</h2>
    <div id="result" class="mt-3 bg-gray-100 dark:bg-gray-700 p-4 rounded-lg border border-gray-300 dark:border-gray-600">
      -
    </div>

  </div>

<script>
/* ---------------------------------------------------------
   CUSTOM GRED SYSTEM (YOUR ORIGINAL VALUES)
--------------------------------------------------------- */
function getGradeData(mark) {
  if (mark >= 90) return { grade: "A+", value: 0 };
  if (mark >= 80) return { grade: "A",  value: 1 };
  if (mark >= 70) return { grade: "A-", value: 2 };
  if (mark >= 66) return { grade: "B+", value: 3 };
  if (mark >= 60) return { grade: "B",  value: 4 };
  if (mark >= 55) return { grade: "C+", value: 5 };
  if (mark >= 50) return { grade: "C",  value: 6 };
  if (mark >= 46) return { grade: "D",  value: 7 };
  if (mark >= 40) return { grade: "E",  value: 8 };
  return { grade: "F", value: 9 };
}

/* ---------------------------------------------------------
   SUBJECT LIST (YOUR ORIGINAL LIST)
--------------------------------------------------------- */
const subjectList = [
  "Bahasa Melayu",
  "Bahasa Inggeris",
  "Matematik",
  "Sains",
  "Sejarah",
  "Matematik Tambahan",
  "Fizik",
  "Kimia",
  "Biologi",
  "Pendidikan Islam",
  "Pendidikan Moral",
  "Ekonomi",
  "Perakaunan",
  "Perniagaan",
  "Reka Bentuk & Teknologi (RBT)",
  "Sains Komputer",
  "Prinsip Perakaunan",
  "Geografi",
  "Kesusasteraan Melayu",
  "Kesusasteraan Tamil",
  "Seni Visual",
  "Pendidikan Jasmani & Kesihatan",
  "Bahasa Tamil",
  "Bahasa Cina",
  "Bahasa Arab",
  "Pendidikan Al-Quran dan Al-Sunnah",
  "Pendidikan Syariah Islamiah"
];

/* ---------------------------------------------------------
   GENERATE SUBJECT INPUT BLOCKS
--------------------------------------------------------- */
function generateSubjects() {
  const total = parseInt(document.getElementById("totalSubjects").value);
  const container = document.getElementById("subjectsContainer");

  if (total <= 0) return;

  // Remove setup area after clicking "Set"
  document.getElementById("setupArea").classList.add("hidden");

  container.innerHTML = "";

  for (let i = 1; i <= total; i++) {
    container.innerHTML += `
      <div class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 p-4 rounded-xl shadow-sm">
        <label class="font-medium">Subjek ${i}</label>

        <select class="w-full mt-2 p-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" data-subject>
          ${subjectList.map(sub => `<option value="${sub}">${sub}</option>`).join("")}
        </select>

        <input type="number" min="0" max="100"
          class="w-full mt-3 p-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"
          placeholder="Markah (0 - 100)" data-mark>
      </div>
    `;
  }

  document.getElementById("calcBtn").classList.remove("hidden");
}

/* ---------------------------------------------------------
   CALCULATE GP
--------------------------------------------------------- */
function calculateGP() {
  const subjectSelects = document.querySelectorAll("[data-subject]");
  const markInputs = document.querySelectorAll("[data-mark]");

  let totalValue = 0;
  let totalMarks = 0;
  let breakdown = "";
  let selectedSubjects = new Set();

  // CHECK DUPLICATES
  for (let sel of subjectSelects) {
    if (selectedSubjects.has(sel.value)) {
      alert("Ralat: Subjek \"" + sel.value + "\" telah dipilih lebih dari sekali!");
      return;
    }
    selectedSubjects.add(sel.value);
  }

  // PROCESS EACH SUBJECT
  for (let i = 0; i < markInputs.length; i++) {
    const mark = parseInt(markInputs[i].value) || 0;
    const subject = subjectSelects[i].value;

    const data = getGradeData(mark);

    totalValue += data.value;
    totalMarks += mark;

    breakdown += `
      <div class="flex justify-between bg-white dark:bg-gray-800 p-3 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm mb-2">
        <span>${subject}</span>
        <span class="font-semibold text-indigo-600 dark:text-indigo-300">${data.grade}</span>
      </div>
    `;
  }

  const GP = (totalValue / markInputs.length).toFixed(2);

  document.getElementById("result").innerHTML = `
    <p class="text-xl font-bold text-indigo-600 dark:text-indigo-300 mb-3">GP: ${GP}</p>
    <p class="text-md font-semibold mb-4">Jumlah Markah: ${totalMarks}/${markInputs.length * 100}</p>
    ${breakdown}
  `;

  document.getElementById("downloadBtn").classList.remove("hidden");
}

/* ---------------------------------------------------------
   PDF DOWNLOAD
--------------------------------------------------------- */
function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: "pt", format: "a4" });

  doc.setFontSize(18);
  doc.text("Keputusan GP SPM", 40, 50);

  let content = document.getElementById("result").innerText;
  doc.setFontSize(12);
  doc.text(content, 40, 90);

  doc.save("SPM_GP_Result.pdf");
}

</script>

</body>
</html>
